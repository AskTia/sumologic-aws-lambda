---
Global:
  TemplatePath: "../KinesisFirehoseCWLogs.template.yaml"
  TestProjectName: BasicTestProject
  ParallelTestsRun: 7
  GlobalParameters:
    Section1aCollectLogs: 'No'
    Section2aCreateS3Bucket: 'No'
    # We are providing dummy values here, as we are testing expected resources and outputs and not functionality with test cases.
    Section1bSumoLogicKinesisLogsURL: "https://localhost.com"
    Section2bFailedDataS3Bucket: "cf-templates-1teub4jja8pis-us-east-1"
Tests:
  - TestName: installnothing
    Regions:
      - us-east-1
    Parameters:
      Values:
        Section2bFailedDataS3Bucket: "dummy"
    Skip: false
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
      - AssertType: OutputsCheck
        Assert:
          Outputs:
  - TestName: installlogswithexistingbucket
    Regions:
      - us-east-1
    Parameters:
      Values:
        Section1aCollectLogs: 'Yes'
    Skip: false
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - FirehoseLogsRole
            - AttachBucketPolicyToFirehoseLogsRole
            - KinesisLogsLogGroup
            - KinesisLogsLogStream
            - KinesisLogsLogStreamS3
            - KinesisLogsRole
            - KinesisLogsRolePolicy
            - KinesisLogsDeliveryStream
            - KinesisLogsFirehoseRolePolicy
            - SubscriptionFilter
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - KinesisLogsDeliveryStreamARN
            - KinesisLogsRoleARN
            - KinesisLogsLogGroupARN
  - TestName: installlogswithnewbucket
    Regions:
      - us-east-1
    Parameters:
      Values:
        Section1aCollectLogs: 'Yes'
        Section2aCreateS3Bucket: 'Yes'
        Section2bFailedDataS3Bucket: 'kinesis-firehose-testing-23173612910'
    Skip: false
    Assertions:
      - AssertType: ResourceExistence
        Assert:
          Resources:
            - FailedDataBucket
            - FirehoseLogsRole
            - AttachBucketPolicyToFirehoseLogsRole
            - KinesisLogsLogGroup
            - KinesisLogsLogStream
            - KinesisLogsLogStreamS3
            - KinesisLogsRole
            - KinesisLogsRolePolicy
            - KinesisLogsDeliveryStream
            - KinesisLogsFirehoseRolePolicy
            - SubscriptionFilter
      - AssertType: OutputsCheck
        Assert:
          Outputs:
            - FailedDataBucketArn
            - KinesisLogsDeliveryStreamARN
            - KinesisLogsRoleARN
            - KinesisLogsLogGroupARN